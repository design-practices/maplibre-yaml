---
interface Props {
  yaml: string;
  height?: string;
  caption?: string;
}

const { yaml, height = '400px', caption } = Astro.props;

// Parse YAML to JSON config for the web component
import { safeParseYAMLConfig } from '@maplibre-yaml/core';
const config = safeParseYAMLConfig(yaml);
const configJson = JSON.stringify(config);
---

<figure class="livemap-container">
  <div class="livemap-wrapper">
    <ml-map style={`height: ${height}; display: block;`} config={configJson}></ml-map>
  </div>
  {caption && <figcaption>{caption}</figcaption>}
</figure>

<script>
  import '@maplibre-yaml/core/register';
  import 'maplibre-gl/dist/maplibre-gl.css';
</script>

<style>
  .livemap-container {
    margin: 1.5rem 0;
  }
  .livemap-wrapper {
    border-radius: 8px;
    border: 1px solid var(--sl-color-gray-5);
    overflow: hidden;
  }
  figcaption {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--sl-color-gray-3);
    text-align: center;
    font-style: italic;
  }
</style>